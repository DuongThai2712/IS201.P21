<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Quản lý khách hàng</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link href='https://fonts.googleapis.com/css?family=Inter' rel='stylesheet'>
  <style>
    * {
      box-sizing: border-box;
      font-family: 'Inter';
      font-size: 14px;
      font-weight: regular;
    }
    body {
      margin: 0;
      background-color: #f5f5f5;
    }
    .topbar {
      background-color: #deb85f;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      font-weight: regular;
    }
    .topbar .right {
      display: flex;
      align-items: center;
      gap: 15px;
      position: relative;
    }
    .dropdown-toggle {
      cursor: pointer;
      position: relative;
    }
    .dropdown-toggle:hover #dropdownMenu {
      display: flex;
    }
    .dropdown-menu {
      position: absolute;
      top: 40px;
      right: 0;
      background-color: white;
      border: 1px solid #ccc;
      width: 160px;
      display: none;
      flex-direction: column;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      z-index: 1000;
    }
    .dropdown-menu div {
      padding: 10px;
      border-bottom: 1px solid #ddd;
      cursor: pointer;
    }
    .dropdown-menu div:hover {
      background-color: #eee;
    }
    .container {
      display: flex;
    }
    .sidebar {
      width: 240px;
      background-color: white;
      height: calc(100vh - 50px);
      padding-top: 10px;
      border-right: 1px solid #ddd;
    }
    .sidebar .profile {
      text-align: center;
      margin-bottom: 20px;
    }
    .sidebar .profile i {
      font-size: 50px;
    }
    .sidebar .profile .name {
      font-weight: bold;
    }
    .sidebar .profile .role {
      font-size: 13px;
      color: #666;
    }
    .menu-item {
      display: flex;
      align-items: center;
      padding: 10px 20px;
      cursor: pointer;
    }
    .menu-item:hover, .menu-item.active {
      background-color: #eee;
    }
    .menu-item i {
      margin-right: 10px;
    }
    .main {
      flex: 1;
      padding: 20px;
    }
    .notification {
      position: fixed;
      top: 60px;
      text-align: right;
      right: 20px;
      padding: 12px 12px;
      font-weight: bold;
      border-radius: 4px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      display: flex;
      align-items: center;
      gap: 20px;
      z-index: 9999;
      animation: slideDown 0.5s ease-out;
      max-width: 400px;
    }
    .notification.success {
      background-color: #4caf50;
      color: white;
    }
    .notification.error {
      background-color: #e53935;
      color: white;
    }
    .notification.hidden {
      display: none;
    }
    .notification .close-btn {
      cursor: pointer;
      font-size: 13px;
      font-weight: bold;
    }
    .dashboard {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }
    .card {
      background-color: white;
      flex: 1;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .card i {
      background-color: #deb85f;
      padding: 10px;
      border-radius: 50%;
      color: black;
    }
    .card .text {
      font-size: 14px;
    }
    .card .text a {
      font-weight: bold;
      color: black;
      text-decoration: none;
    }
    .card .text a:hover {
      text-decoration: underline;
    }
    .grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      grid-gap: 20px;
    }
    .section {
      border-radius: 4px;
      padding: 10px 15px;
      margin-bottom: 0px;
    }
    .section h3 {
      padding: 10px;
      margin: -10px -15px 10px -15px;
      font-size: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      border: 1px solid #ddd;
    }
    table th, table td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    table th {
      background-color: #deb85f;
    }
    .search-bar {
      display: flex;
      width: 100%;
      justify-content: flex-end;
      margin-bottom: 20px;
    }
    .search-bar input {
      padding: 5px;
      width: 100%;
      border: 1px solid #ddd;
      border-radius: 4px;
      height: 40px;
    }
    .search-bar button {
      padding: 5px 10px;
      background-color: #deb85f;
      color: #000;
      border: none;
      border-radius: 4px;
      margin-left: 5px;
      cursor: pointer;
    }
    .disabled {
      opacity: 0.5;
      pointer-events: none;
      background-color: #f0f0f0;
    }

    .tab {
      overflow: hidden;
      border-bottom: 1px solid #ddd;
      background-color: #f1f1f1;
    }

    .tab button {
      background-color: inherit;
      float: left;
      border: none;
      outline: none;
      cursor: pointer;
      padding: 10px 16px;
      transition: 0.3s;
      font-size: 16px;
    }

    .tab button:hover {
      background-color: #ddd;
    }

    .tab button.active {
      background-color: #deb85f;
      color: black;
    }

    .tabcontent {
      display: none;
      padding: 20px 0;
    }

    .tabcontent.active {
      display: block;
    }
    @keyframes slideDown {
      from { top: 20px; opacity: 0; }
      to { top: 60px; opacity: 1; }
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div><b>Hệ thống quản lý và phân công Tour</b></div>
    <div class="right">
      <div>Welcome back, <b>Đỗ Bạch Diễm Uyên</b></div>
      <i class="material-icons">notifications</i>
      <i class="material-icons">settings</i>
      <div class="dropdown-toggle">
        <i class="material-icons">account_circle</i>
        <div class="dropdown-menu" id="dropdownMenu">
          <div onclick="alert('Xem nhật ký sử dụng')">Nhật ký sử dụng</div>
          <div onclick="alert('Chuyển đến đổi mật khẩu')">Đổi mật khẩu</div>
          <div onclick="alert('Đã đăng xuất');window.location.href='DangNhap.html'">Đăng xuất</div>
        </div>
      </div>
    </div>
  </div>

  <div class="notification hidden" id="alertBox">
    <div style="display: flex; flex-direction: column;">
      <div><b>Thông báo:</b></div>
      <div id="alertMessage"></div>
    </div>
    <span class="close-btn" onclick="closeAlert()">×</span>
  </div>

  <div class="container">
    <div class="sidebar">
      <div class="profile">
        <i class="material-icons">account_circle</i>
        <div class="name">Đỗ Bạch Diễm Uyên</div>
        <div class="role">Phòng Điều hành</div>
      </div>
      <div class="menu-item" onclick="window.location.href='TrangChu.html'"><i class="material-icons">home</i>Trang chủ</div>
      <div class="menu-item" onclick="window.location.href='QuanLyTour.html'"><i class="material-icons">tour</i>Quản lý Tour</div>
      <div class="menu-item" onclick="window.location.href='DatTour.html'"><i class="material-icons">receipt</i>Quản lý thông tin đặt Tour</div>
      <div class="menu-item" onclick="window.location.href='LichPhanCong.html'"><i class="material-icons">calendar_today</i>Quản lý lịch phân công</div>
      <div class="menu-item" onclick="window.location.href='NhanSu.html'"><i class="material-icons">groups</i>Quản lý nhân sự</div>
      <div class="menu-item" onclick="window.location.href='KhachHang.html'"><i class="material-icons">person</i>Quản lý khách hàng</div>
      <div class="menu-item active" onclick="window.location.href='ThamGiaTour.html'"><i class="material-icons">schedule</i>Đăng ký tham gia Tour</div>
      <div class="menu-item" onclick="window.location.href='BaoCao.html'"><i class="material-icons">money</i>Báo cáo doanh thu</div>
      <div class="menu-item" onclick="window.location.href='KhaoSat.html'"><i class="material-icons">poll</i>Quản lý khảo sát</div>
      <div class="menu-item" onclick="window.location.href='HoatDong.html'"><i class="material-icons">event</i>Hoạt động và chương trình</div>
    </div>

    <div class="main">
      <div class="tab">
        <button class="tablinks active" onclick="openTab(event, 'tourSelection')">Danh sách Tour để đăng ký</button>
        <button class="tablinks" onclick="openTab(event, 'registeredTours')">Danh sách Tour đã đăng ký</button>
      </div>

      <div id="tourSelection" class="tabcontent" style="display: block;">
        <div class="section" id="tourSelectionSection">
          <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Tìm kiếm...">
            <button class="search-icon" onclick="searchTours()"><i class="material-icons">search</i></button>
          </div>
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr>
                <th>Mã phân công</th>
                <th>Tên Tour</th>
                <th>Số lượng tối đa</th>
                <th>Số lượng đã đăng ký</th>
                <th>Hành động</th>
              </tr>
            </thead>
            <tbody id="availableTours">
              <tr>
                <td>ND001</td>
                <td>Du lịch Đà Lạt</td>
                <td>30</td>
                <td id="registeredCountND001">27</td>
                <td><button style="background-color: #5E79E5; color: white; border: none; padding: 5px 10px; border-radius: 4px;" onclick="registerTour('ND001', 30)">Đăng ký</button></td>
              </tr>
              <tr>
                <td>QT001</td>
                <td>Du lịch Phú Quốc</td>
                <td>10</td>
                <td id="registeredCountQT001">8</td>
                <td><button style="background-color: #5E79E5; color: white; border: none; padding: 5px 10px; border-radius: 4px;" onclick="registerTour('QT001', 10)">Đăng ký</button></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div id="registeredTours" class="tabcontent">
        <div class="section" id="registeredToursSection">
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr>
                <th>Mã phân công</th>
                <th>Thông tin Tour</th>
                <th>SL Đăng ký/Tổng số</th>
                <th>Hành động</th>
              </tr>
            </thead>
            <tbody id="registeredToursBody">
              <!-- Data will be populated by JavaScript -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>
    let tourData = [
      { maPhanCong: "ND001", tenTour: "Du lịch Đà Lạt", maxSlots: 30, registeredSlots: 27 },
      { maPhanCong: "QT001", tenTour: "Du lịch Phú Quốc", maxSlots: 10, registeredSlots: 8 }
    ];
    let registeredTours = [
      { maPhanCong: "ND001", tenTour: "Du lịch Đà Lạt" },
      { maPhanCong: "QT001", tenTour: "Du lịch Phú Quốc" }
    ]; // Dữ liệu mẫu để kiểm tra

    function showAlert(message, isSuccess) {
      const alertBox = document.getElementById("alertBox");
      const alertMessage = document.getElementById("alertMessage");
      alertMessage.textContent = message;
      alertBox.className = "notification " + (isSuccess ? "success" : "error");
      alertBox.classList.remove("hidden");
      setTimeout(() => alertBox.classList.add("hidden"), 3000);
    }

    function closeAlert() {
      document.getElementById("alertBox").classList.add("hidden");
    }

    function updateTourList() {
      const availableTours = document.getElementById("availableTours");
      availableTours.innerHTML = "";
      tourData.forEach(tour => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${tour.maPhanCong}</td>
          <td>${tour.tenTour}</td>
          <td>${tour.maxSlots}</td>
          <td id="registeredCount${tour.maPhanCong}">${tour.registeredSlots}</td>
          <td><button style="background-color: #5E79E5; color: white; border: none; padding: 5px 10px; border-radius: 4px;" onclick="registerTour('${tour.maPhanCong}', ${tour.maxSlots})">Đăng ký</button></td>
        `;
        if (tour.registeredSlots >= tour.maxSlots || registeredTours.some(t => t.maPhanCong === tour.maPhanCong)) {
          row.querySelector("button").classList.add("disabled");
        }
        availableTours.appendChild(row);
      });
    }

    function updateRegisteredTours() {
      const registeredToursList = document.getElementById("registeredToursBody");
      registeredToursList.innerHTML = "";
      registeredTours.forEach(tour => {
        const originalTour = tourData.find(t => t.maPhanCong === tour.maPhanCong);
        const maPhanCong = tour.maPhanCong;
        const thongTinTour = originalTour.tenTour;
        const slDangKyTongSo = `${originalTour.registeredSlots}/${originalTour.maxSlots}`;
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${maPhanCong}</td>
          <td>${thongTinTour}</td>
          <td>${slDangKyTongSo}</td>
          <td><button style="background-color: #E55E5E; color: white; border: none; padding: 5px 10px; border-radius: 4px;" onclick="deleteRegisteredTour('${tour.maPhanCong}')">Hủy</button></td>
        `;
        registeredToursList.appendChild(row);
      });
    }

    function registerTour(maPhanCong, maxSlots) {
      const tour = tourData.find(t => t.maPhanCong === maPhanCong);
      if (!tour) return;

      if (registeredTours.some(t => t.maPhanCong === maPhanCong)) {
        showAlert("Bạn đã đăng ký Tour này!", false);
        return;
      }

      if (tour.registeredSlots >= maxSlots) {
        showAlert("Tour đã đủ số lượng!", false);
        return;
      }

      tour.registeredSlots++;
      registeredTours.push({ maPhanCong: tour.maPhanCong, tenTour: tour.tenTour });
      updateTourList();
      updateRegisteredTours();
      if (tour.registeredSlots >= maxSlots) {
        showAlert("Tour đã đạt số lượng tối đa!", true);
      } else {
        showAlert("Đăng ký Tour thành công!", true);
      }
    }

    function deleteRegisteredTour(maPhanCong) {
      const index = registeredTours.findIndex(t => t.maPhanCong === maPhanCong);
      if (index !== -1) {
        registeredTours.splice(index, 1);
        const tour = tourData.find(t => t.maPhanCong === maPhanCong);
        if (tour) {
          tour.registeredSlots--;
          updateTourList();
          updateRegisteredTours();
          if (tour.registeredSlots < tour.maxSlots) {
            document.querySelector(`#availableTours button[onclick="registerTour('${maPhanCong}', ${tour.maxSlots})"]`).classList.remove("disabled");
          }
          showAlert("Hủy đăng ký Tour thành công!", true);
        }
      }
    }

    function searchTours() {
      const searchTerm = document.getElementById("searchInput").value.toLowerCase();
      const filteredData = tourData.filter(tour =>
        tour.maPhanCong.toLowerCase().includes(searchTerm) ||
        tour.tenTour.toLowerCase().includes(searchTerm)
      );
      const availableTours = document.getElementById("availableTours");
      availableTours.innerHTML = "";
      filteredData.forEach(tour => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${tour.maPhanCong}</td>
          <td>${tour.tenTour}</td>
          <td>${tour.maxSlots}</td>
          <td id="registeredCount${tour.maPhanCong}">${tour.registeredSlots}</td>
          <td><button style="background-color: #5E79E5; color: white; border: none; padding: 5px 10px; border-radius: 4px;" onclick="registerTour('${tour.maPhanCong}', ${tour.maxSlots})">Đăng ký</button></td>
        `;
        if (tour.registeredSlots >= tour.maxSlots || registeredTours.some(t => t.maPhanCong === tour.maPhanCong)) {
          row.querySelector("button").classList.add("disabled");
        }
        availableTours.appendChild(row);
      });
    }

    document.getElementById("searchInput").addEventListener("keypress", function(event) {
      if (event.key === "Enter") {
        searchTours();
      }
    });

    function openTab(evt, tabName) {
      var i, tabcontent, tablinks;
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }
      document.getElementById(tabName).style.display = "block";
      evt.currentTarget.className += " active";
      
      // Update tables when switching tabs
      if (tabName === 'tourSelection') {
        updateTourList();
      } else if (tabName === 'registeredTours') {
        updateRegisteredTours();
      }
    }

    // Initial load
    document.addEventListener('DOMContentLoaded', () => {
      updateTourList();
      updateRegisteredTours(); // Đảm bảo gọi hàm này khi tải trang
      document.querySelector(".tablinks").classList.add("active");
      document.getElementById("tourSelection").style.display = "block";
    });
  </script>
</body>
</html>